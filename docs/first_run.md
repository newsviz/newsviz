# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø–∞–π–ø–ª–∞–Ω—É
–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–¥–µ—Å—å:
https://github.com/newsviz/newsviz/tree/master/newsviz
## –§–∞–π–ª–∏–∫–∏:  
- `pipeline.py` —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ [luigi](https://github.com/spotify/luigi) —Ç–∞—Å–∫–∏. –¢–∞–º –ø—Ä–æ–ø–∏—Å–∞–Ω–æ, —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ –∫–∞–∫.
- `../config/config.ini` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º, –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–º –º–æ–¥–µ–ª—è–º –∏ –ø—Ä–æ—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
- `topic_model.py` –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª—å—é
- `preprocessing_tools.py` —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—ã—Ä–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è, –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è, –æ—á–∏—Å—Ç–∫–∞ –æ—Ç —Å—Ç–æ–ø-—Å–ª–æ–≤

## –ê –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `init_proj.py` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `--basedir` –≥–¥–µ –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ `--projname` –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–¥–µ–ª–µ–π. –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —à–∞–±–ª–æ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥. –ù–∞–ø—Ä–∏–º–µ—Ä `python init_proj.py --basedir ../mytestdir --projname testproj` —Å–æ–∑–¥–∞—Å—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `../mytestdir` –≤ –∫–æ—Ç–æ—Ä–æ–π —Å–æ–∑–¥–∞—Å—Ç –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∞ —Ç–∞–∫ –∂–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `../config/config_testproj.ini` —Å –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏. –ü–æ–∫–∞ NewsViz –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≥–ª—è–Ω—É—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥ –∏ –ø–æ–Ω—è—Ç—å —á—Ç–æ —Ç–∞–º –ø–æ—á–µ–º—É.  
2. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (–≤–º–µ—Å—Ç–æ `data` –≤–∞—à–∞ `basedir`):
    - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å "—Å—ã—Ä—ã–º–∏" –¥–∞–Ω–Ω—ã–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/raw`)
    - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è "–æ—á–∏—â–µ–Ω–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/processed`)
    - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/classified`)
    - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/topic_model_ed`)
    - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö –∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/ready2viz`)
3. –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Å—ã—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–¥ –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–ø–æ –µ—ë –Ω–∞–∑–≤–∞–Ω–∏—é –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ä–∞–∑–¥–µ–ª –≤ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏) –∫–ª–∞–¥—ë–º csv.gz —Ñ–∞–π–ª—ã (pandas —É–º–µ–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å csv —Å–æ —Å–∂–∞—Ç–∏–µ–º: `df.to_csv('fname.csv.gz', compression='gzip')`). –¢–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏ `text,topics,date`.
    - `text` -- –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞, –∫–∞–∫ –∏—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ —á–∏—Ç–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `pandas`,
    - `date` -- –¥–∞—Ç–∞, –≤ –ª—é–±–æ–º –≤–∏–¥–µ, –∫–∞–∫–æ–π –ø–æ–Ω–∏–º–∞–µ—Ç `pandas`,
    - `topics` -- –º–µ—Ç–∫–∏ —Ä—É–±—Ä–∏–∫
4. –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º–∏. –û–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–≤–æ–¥–æ–≤ —ç—Ç–∞–ø–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞
5. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä—É–±—Ä–∏–∫ –∏ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å bigARTM —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Å–ª–æ–≤–∞—Ä—ë–º  
    - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –º–µ—Ç–æ–¥ `predict`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç–∫–∏ –∫–ª–∞—Å—Å–æ–≤.
    - –ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–ª–∞–≥–∞—Ç—å—Å—è —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å –º–µ—Ç–æ–¥–æ–º `transform`. –ù–∞ –≤—Ö–æ–¥–µ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–∞ –≤—ã—Ö–æ–¥–µ –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.
    - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ `joblib`
    - ARTM –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É—á–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ—Ä–µ–∑ –æ–±—ë—Ä—Ç–∫—É –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–æ–¥–æ–º `save_model`, –≤—ã—Ç–∞—â–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å –∏–∑ `/dir_path/dicts/` (dir_path -- —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–∞), —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ø-—Å–ª–æ–≤ –ø–æ —Ç–µ–º–∞–º –¥–ª—è –∫–∞–∂–¥–æ–π —Ä—É–±—Ä–∏–∫–∏ (–∫–ª–∞—Å—Å–∞ –∏–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞).
    - –î–ª—è –æ–±—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –µ—Å—Ç—å jupyter notebook —Å –ø—Ä–∏–º–µ—Ä–æ–º [html –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞](https://newsviz.github.io/pages/make_news_viz_classifier.html) –∏ [ipynb —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å](https://github.com/newsviz/newsviz.github.io/blob/master/notebooks/make_news_viz_classifier.ipynb)
    - –î–ª—è —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏ –µ—Å—Ç—å [—Å–∫—Ä–∏–ø—Ç](https://github.com/newsviz/newsviz/blob/master/templates/make_tm.py) –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–¥–æ –ø–µ—Ä–µ–ª–æ–∂–∏—Ç—å –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∏–∂–µ, –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ —Å–≤–æ—é –∑–∞–¥–∞—á—É –∏ –∑–∞—É–ø—É—Å—Ç–∏—Ç—å
6. –ü–æ—Ç–æ–º –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –≥–¥–µ —á—Ç–æ –ª–µ–∂–∏—Ç –≤ `config.ini` (–∏–ª–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é) –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≥–¥–µ –ª–µ–∂–∏—Ç `pipeline.py` —Ç–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É:
```
PYTHONPATH='.' luigi --module pipeline TopicPredictorTask --conf=../config/config.ini --local-scheduler
```
–ù—É –∏ –≤—Å—ë üòé

## –†–µ–∑—É–ª—å—Ç–∞—Ç
–î–∞–ª—å—à–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–µ–º, —á—Ç–æ –≤ `config.ini` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
–í `processed` –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å —Ñ–∞–π–ª–∏–∫–∏ —Å —Ç–µ–º–∏ –∂–µ –∏–º–µ–Ω–∞–º–∏, —á—Ç–æ –∏ –≤ `raw`, —Ç–æ–ª—å–∫–æ —Ç–∞–º –±—É–¥–µ—Ç –∫–æ–ª–æ–Ω–∫–∞ `lemmatized` —Å –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º, –∏ —Ç–µ –∂–µ `date` –∏ `topics` –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –í `classified` —Ñ–∞–π–ª–∏–∫–∏ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `date` –∏ `rubric_preds` -- –≥–¥–µ –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å –º–µ—Ç–∫–∏ –∫–ª–∞—Å—Å–æ–≤. –í `ready2viz` –∑–∞–ø–∏—à—É—Ç—Å—è —Ñ–∞–π–ª—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏. –ù–∞ –∫–∞–∂–¥—ã–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ –≤—Ö–æ–¥–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏—Ç—Å—è n_classes —Ñ–∞–π–ª–æ–≤ —Å —Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π. –¢–æ –µ—Å—Ç—å –µ—Å–ª–∏ –±—ã–ª–æ 3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ `raw` –∏ 5 —Ç–µ–º, —Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è 15 —Ñ–∞–π–ª–æ–≤ –≤ `ready2viz`. –¢–∞–º –±—É–¥–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ `date` –∏ –∫–æ–ª–æ–Ω–∫–∏ –≤–∏–¥–∞ `topic_1,topic_2...`. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–º –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ –º–æ–¥–µ–ª—å –æ–±—É—á–∏–ª–∏. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.

## –ö–∞–∫ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
### –ß–µ—Ä–µ–∑ Dash —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞, –∏–ª–∏ –∫–æ–≥–¥–∞ —É–∂–µ –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ ready2viz –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `newsviz` –≤—ã–ø–æ–ª–Ω–∏—Ç—å `python app.py`. –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è Dash –∏ —Ç–∞–º –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –∫–∞–∫.

### –ß–µ–º —É–≥–æ–¥–Ω–æ
–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –∫–æ–ª–æ–Ω–∫–∏ `topic_*` —ç—Ç–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω–æ–π —Ç–µ–º—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –º—ã —Å—É–º–º–∏—Ä—É–µ–º —Ç–∞–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º. –¢–æ –µ—Å—Ç—å
```
data['year'] = data['date'].dt.year
data['month'] = data['date'].dt.month
gb = data.groupby(['year', 'month'])[topics].sum()
```
–∏ –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å. –° matplotlib —ç—Ç–æ –±—É–¥–µ—Ç –±—É–∫–≤–∞–ª—å–Ω–æ `plt.plot(gb['topic_1'].values)`. –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ –¥—Ä—É–≥–æ–π –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –¥–∞—Ç. –≠—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –ø–µ—Ä–∏–æ–¥–∞ –∏ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—Ç—Å—è —Ç–µ–º—ã.
